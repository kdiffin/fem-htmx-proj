// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: relations_user_vault.sql

package db

import (
	"context"
)

const signUpAndCreateDefaultVault = `-- name: SignUpAndCreateDefaultVault :exec
WITH
  new_vault AS (
    INSERT INTO vaults (name, description, kind)
    VALUES ('Your default vault', 'This is your default vault. Only you can access this.', 'default')
    RETURNING id
  ),
  new_user AS (
    INSERT INTO users (username, password_hash, default_vault_id)
    VALUES ($1, $2, (SELECT id FROM new_vault))
    RETURNING id
  )
    INSERT INTO vault_user_relations (vault_id, role, user_id)
    VALUES (
      (SELECT id FROM new_vault),
      'owner',
      (SELECT id FROM new_user)
    )
`

type SignUpAndCreateDefaultVaultParams struct {
	Username     string
	PasswordHash string
}

func (q *Queries) SignUpAndCreateDefaultVault(ctx context.Context, arg SignUpAndCreateDefaultVaultParams) error {
	_, err := q.db.Exec(ctx, signUpAndCreateDefaultVault, arg.Username, arg.PasswordHash)
	return err
}
